@page "/borrowers/{id:int}"
@using CollectionManagementBlazor.Models
@inject NavigationManager NavigationManager

<PageTitle>Borrower Details</PageTitle>

<div class="page-container">
    <div class="page-header">
        <h1>Borrower Details</h1>
        <p>Complete profile and interaction history</p>
    </div>

    @if (borrower == null)
    {
        <div class="text-center p-4">
            <div class="loading-spinner"></div>
            <p class="mt-3">Loading borrower information...</p>
        </div>
    }
    else
    {
        <div class="detail-container">
            <!-- Sidebar with Borrower Info -->
            <div class="detail-sidebar">
                <div class="detail-avatar">@GetInitials(borrower.Name)</div>
                <div class="detail-info">
                    <div class="detail-name">@borrower.Name</div>
                    <div class="detail-id">ID: @borrower.Id</div>
                </div>

                <div class="info-section">
                    <div class="info-title">Contact Information</div>
                    <div class="info-row">
                        <span class="info-label">Email:</span>
                        <span class="info-value">@borrower.Email</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Phone:</span>
                        <span class="info-value">@borrower.Phone</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Address:</span>
                        <span class="info-value">@borrower.Address</span>
                    </div>
                </div>

                <div class="info-section">
                    <div class="info-title">Account Status</div>
                    <div class="info-row">
                        <span class="info-label">Status:</span>
                        <span class="info-value">
                            <span class="modern-badge success">Active</span>
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Member Since:</span>
                        <span class="info-value">@borrower.MemberSince.ToShortDateString()</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Total Loans:</span>
                        <span class="info-value">@borrower.TotalLoans</span>
                    </div>
                </div>

                <div class="d-flex flex-column gap-2 mt-4">
                    <button class="btn btn-sm btn-primary" @onclick="EditBorrower">Edit Details</button>
                    <button class="btn btn-sm btn-secondary" @onclick="GoBack">Back to List</button>
                </div>
            </div>

            <!-- Main Content Area -->
            <div>
                <!-- Quick Actions -->
                <div class="action-bar">
                    <button class="quick-action primary">
                        ðŸ“ž Call Borrower
                    </button>
                    <button class="quick-action">
                        ðŸ’¬ Send SMS
                    </button>
                    <button class="quick-action">
                        ðŸ“§ Send Email
                    </button>
                    <button class="quick-action">
                        ðŸ“„ View Documents
                    </button>
                    <button class="quick-action">
                        ðŸ’° View Loans
                    </button>
                </div>

                <!-- Tabs Section -->
                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab @(activeTab == "loans" ? "active" : "")" @onclick='() => activeTab = "loans"'>
                            Loan Accounts
                        </div>
                        <div class="tab @(activeTab == "payments" ? "active" : "")" @onclick='() => activeTab = "payments"'>
                            Payment History
                        </div>
                        <div class="tab @(activeTab == "interactions" ? "active" : "")" @onclick='() => activeTab = "interactions"'>
                            Interactions
                        </div>
                        <div class="tab @(activeTab == "documents" ? "active" : "")" @onclick='() => activeTab = "documents"'>
                            Documents
                        </div>
                    </div>

                    <div class="tab-content">
                        @if (activeTab == "loans")
                        {
                            <h4 class="mb-3">Active Loan Accounts</h4>
                            <div class="table-responsive">
                                <table class="modern-table">
                                    <thead>
                                        <tr>
                                            <th>Account #</th>
                                            <th>Type</th>
                                            <th>Amount</th>
                                            <th>Balance</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>LN-001</td>
                                            <td>FPO Loan</td>
                                            <td>â‚¹50,000</td>
                                            <td>â‚¹45,000</td>
                                            <td><span class="modern-badge success">Current</span></td>
                                            <td>
                                                <button class="btn btn-modern btn-sm btn-primary">View</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        }
                        else if (activeTab == "payments")
                        {
                            <h4 class="mb-3">Recent Payments</h4>
                            <div class="timeline">
                                <div class="timeline-item">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <div class="timeline-time">@DateTime.Now.AddDays(-2).ToString("MMM dd, yyyy - hh:mm tt")</div>
                                        <div class="timeline-title">Payment Received - â‚¹15,000</div>
                                        <div class="timeline-description">Bank Transfer via Account ending in 4521. Payment applied to LN-001.</div>
                                    </div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <div class="timeline-time">@DateTime.Now.AddDays(-32).ToString("MMM dd, yyyy - hh:mm tt")</div>
                                        <div class="timeline-title">Payment Received - â‚¹15,000</div>
                                        <div class="timeline-description">UPI Payment. Transaction ID: UPI2023456789</div>
                                    </div>
                                </div>
                            </div>
                        }
                        else if (activeTab == "interactions")
                        {
                            <h4 class="mb-3">Communication History</h4>
                            <div class="timeline">
                                <div class="timeline-item">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <div class="timeline-time">Today, 10:30 AM</div>
                                        <div class="timeline-title">Phone Call - Successful Contact</div>
                                        <div class="timeline-description">Discussed upcoming payment. Customer confirmed payment by end of week.</div>
                                    </div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <div class="timeline-time">Yesterday, 3:45 PM</div>
                                        <div class="timeline-title">SMS Sent - Payment Reminder</div>
                                        <div class="timeline-description">Automatic reminder for upcoming EMI due on 25th. Message delivered successfully.</div>
                                    </div>
                                </div>
                            </div>
                        }
                        else if (activeTab == "documents")
                        {
                            <h4 class="mb-3">Uploaded Documents</h4>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <div class="modern-card">
                                        <h6>ðŸ“„ ID Proof</h6>
                                        <p class="text-muted small">Uploaded: @DateTime.Now.AddMonths(-6).ToShortDateString()</p>
                                        <button class="btn btn-modern btn-sm btn-primary mt-2">View</button>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="modern-card">
                                        <h6>ðŸ“„ Address Proof</h6>
                                        <p class="text-muted small">Uploaded: @DateTime.Now.AddMonths(-6).ToShortDateString()</p>
                                        <button class="btn btn-modern btn-sm btn-primary mt-2">View</button>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public int Id { get; set; }

    private Borrower? borrower;
    private string activeTab = "loans";

    protected override async Task OnInitializedAsync()
    {
        // TODO: Replace with actual API call
        await Task.Delay(500); // Simulate loading

        borrower = new Borrower
        {
            Id = Id,
            Name = "John Doe",
            Email = "john.doe@example.com",
            Phone = "+91 98765 43210",
            Address = "123 Main Street, Pune, Maharashtra",
            MemberSince = DateTime.Now.AddYears(-2),
            TotalLoans = 1
        };
    }

    private string GetInitials(string name)
    {
        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
            return $"{parts[0][0]}{parts[1][0]}".ToUpper();
        return name.Length >= 2 ? name.Substring(0, 2).ToUpper() : name.ToUpper();
    }

    private void EditBorrower()
    {
        // TODO: Navigate to edit page
    }

    private void GoBack()
    {
        NavigationManager.NavigateTo("/borrowers");
    }

    private class Borrower
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public string Phone { get; set; } = string.Empty;
        public string Address { get; set; } = string.Empty;
        public DateTime MemberSince { get; set; }
        public int TotalLoans { get; set; }
    }
}
